#### OSI

名称 | 功能 | 使用邮件A | 使用邮件B
---|---|---|---
应用层 | 针对特定应用的协议 | 传送数据前端在附加首部信息，标明收件人与内容 | 分析首部与数据正文，并保存到硬盘或其他存储器以备相应处理，异常解决
表示层 | 设备固有数据格式和网络标准数据格式的转换 | 将A邮件客户端的数据格式转换成网络通用的标准数据格式 | 将网络通用标准数据格式转换成客户端数据格式
会话层 | 通信管理。建立和断开通信连接。管理传输层以下的分层 | 决定建立连接的方式，建立五个连接或者建立一个连接连续发送 | /
传输层 | 管理两个节点之间的数据传输。负责可靠传输 | 进行建立连接或者断开连接的处理，此外，为了保证传输的数据到达目标地址，会在通信两端的计算机之间进行确认，数据没到达的情况进行重发 | /
网络层 | 地址管理与路由选择 | 将数据从发送端主机发送到接收端主机，网络层负责将数据发送至最终目标地址 | /
数据链路层 | 互连设备之间传送和识别数据帧 | 数据链路层负责实现每一个区间的通信 | /
物理层 | 以0，1代表电压的高低，灯光的闪灭。界定连接器和网线的规格 | 将数据的0,1转换成电压和脉冲光传输给物理的传输介质，而相直连的设备之间使用地址(MAC)进行传输。| /

##### 传输方式分类
1. 
- 面向有连接型
    
    在发送数据之前，需要在收发主机之间连接一条通信线路。(ATM, 帧中继，TCP等)
- 面向无连接型
    不要求建立和断开连接。发送端可于任何时候自由发送数据。接收端也永远不知道自己会在何时收到数据。此种情况下，接收端需要时常确认是否收到了数据。(以太网, IP, UDP等)

2. 

- 电路交换
    
    主要由交换机负责数据的中转处理，计算机首先被连接到交换机，交换机之间由众多通信线路继续连接。计算机之间在发送数据时，需要通过交换机与目标主机建立通信电路。(独占一条线路，无法预测开始结束时间，并发超过通信线路数量)
- 分组交换

    连接到通信电路的计算机将所要发送的数据分为多个数据包，按照一定的顺序排列之后分别发送。由分组交换机(路由器)链接通信线路。

3. 
- 单播(Unicast)
- 广播(Broadcast)
- 多播(Multicast) : 组
- 任播(Anycast): 选择一台最符合网络条件的

##### 网络要素
名称 | 功能 | 备注
---|---|---
通信媒介和电缆 | 连接 | /
网卡 | 使计算机联网的设备 | /
中继器 | 物理层延长网络 | 一般情况下两端连接的是相同的通信媒介
网桥 | 数据链路层连接两个网络的设备 | 根据MAC地址进行处理，根据数据帧的内容转发给其他网络，没有连接网段个数限制，基本只用于连接相同属性，也可以连接传输速率不同的网络
路由器 | 网络层面上连接两个网络，对分组报文进行转发的设备 | 根据IP地址处理，也有分担网络负荷的作用
4-7层交换机 | 从传输层到应用层数据的转换和转发 |
网关 | 网管不仅转发数据还负责对数据进行转换 | 负责读取不同协议后对他们进行合理的转换，再将数据发送。如不同电子邮件的协议，计算机手机也能互相发送邮件

#### TCP/IP基础

##### TCP/IP协议群
- 应用协议: HTTP, SMTP, TELNET, SNMP
- 传输协议: TCP, UDP
- 网际协议: IP, ICMP, ARP
- 路由控制协议: RIP， OSPF, BGP


##### 架构

名称 | 提供方
---|---
物理层 | 设备驱动程序与网络接口
数据链路层 | 设备驱动程序与网络接口
网络层 | 操作系统
传输层 | 操作系统
数据链路层 | 应用程序

- 客户端/服务端模型
- WWW, http(OSI应用层), HTML(表示层)
- 电子邮件, SMTP(OSI应用层)，MIME协议扩展类型(表示层)
- 文件传输，FTP(应用层，建立两个tcp,分别是传输请求所使用的控制连接和实际传输数据用的数据连接)
- 远程登录，TELNET（应用层）, SSH（应用层）
- 网络管理, SNMP（应用层）, MIB（表示层, 保存网络信息）

##### 发送数据包

1. 应用程序处理: 应用程序编码处理(表示层)，编码完成后管理何时建立通信连接何时发送数据(会话层)，在发送邮件的一刻建立tcp连接并利用此连接发送数据
2. Tcp根据应用知识，负责建立连接，发送数据，断开连接。++提供将应用层发来得数据顺利发送至对端的可靠传输++。在应用层数据前端附加一个TCP首部，提供源端口号和目标端口，序号(发送包数据顺序)以及校验(判断数据是否损坏)。随后发送给IP
3. IP将之前数据合并当成自己数据并加入IP首部，首部中包含接收端IP地址以及发送端IP地址，以及判断后面数据是TCP还是UDP的信息。++之后参考路由控制表决定接受IP包的路由或主机，IP包将被发送给连接这些路由器或主机网络接口的驱动程序++。(此时如果不知道MAC地址，可利用ARP协议查找)
4. IP包在以太网驱动中被加入以太网首部并进行发送处理，包含发送端MAC地址、接收端MAC地址以及标志以太网类型的以太网数据的协议。最后包被追加以太网包尾。
5. ++包首部至少包含发送端与接收端地址，以及上一次的协议类型++

##### 接收数据包
1. 主机收到以太网包后，从以太网包首部++找到MAC地址判断是否为发给自己的包++，如果不是则丢弃数据。如果接受到了七号是发送给自己的包，就查找以太网包首部中的类型域从而将数据传给处理IP的子程序。
2. IP地址匹配，接受数据并查找上层协议。(TCP/UDP), 在有看路由器的情况下，接收端地址往往不是自己地址，此时需要借助路由控制表，在调查应该送达的主机或路由器后再转发数据。
3. TCP++计算冗余校验和判断数据是否破坏++，检查是否按照序号接受数据。最后检查端口号，确定具体的应用程序。接受完毕后，接收端发送一个确认回执给发送端。如果回执未收到，发送端会反复发送。完整接受后传给端口号识别的应用程序。
4. 应用程序后直接接收数据。通过解析数据获取邮件。


#### 数据链路层

#####  MAC地址
烧入ROM中，48位不重复。3-24位表示厂商识别码

##### 共享介质型网络
多个设备共享一个通信介质的一种网络。在这种方式下，设备之间使用同一个载波信道进行发送和接受。基本采用++半双工通信++，并有必要++对介质进行访问控制++。有两种方式： 

 - 争用方式(CSMA)
 
    通常令网络中的各个站采用先到先得的方式占用信道发送数据。多个站同时发送帧会发生冲突现象。导致网络拥堵与性能下降

    改良方式:CSMA/CD, 提前检查冲突，发生冲突尽早释放信道。

 - 令牌传递方式
    
    只有获得令牌的站才能够发送数据。不会发生冲突，每个站有平等获得令牌的机会。所以即使拥堵也不会使性能下降。

##### 非共享介质型网络
指不共享介质，对介质采取专用的一种传输控制方式。在这种方式下，网络每个站直连交换机，交换机负责转发数据帧。发送端与接收端不共享通信介质。情况采用全双工通信方式。通过以太网交换机构建网络，从而使计算机与交换机端口形成一对一的连接，这种一对一连接全双工通信不会发生冲突，因此不需要CSMA/CD就可以实现更高效的通信。但是一旦交换机发生故障，相连的计算机都将无法通信。


##### 以太网

IEEE802.3以太网帧体格式: 
- 目标MAC地址(6字节)
- 源MAC地址(6字节)
- 帧长度(2字节)
- LLC(3字节)： 逻辑链路控制层
- SNAP(5字节): 表示上一层协议类型(厂商 + 类型)
- 数据(38-1492字节)
- FCS(4字节): 帧检验序列，检查帧是否损坏

进一步将数据链路层细分： 
介质访问控制层(MAC)：根据以太网或者FDDI等不同数据链路++持有的首部信息进行控制++
逻辑链路层(LLC): 根据以太网或者FDDI等不同数据链路++共有的帧头信息进行控制++

##### 无线通信

分类 | 通信距离 | 相关技术
---|---|---
无线PAN | 10米 | 蓝牙
无线LAN | 100米 | Wi-Fi
无线MAN | 数千米-100千米 | WiMax
无线RAN | 200千米-700千米 | \
无线WAN | \ | 3G、LTE、4G、下一代通信网络


##### PPP
点对点通信，1对1连接计算机的协议。PPP与以太网等相比，属于纯粹的数据链路层，与物理层没有任何关系。所以需要物理层的支持。PPP可以使用多种物理线路，近年主要是ADSL或者有线电视PPPOE实现接入(以太网数据加入ppp帧)。在开始数据传输前，建立一个PPP级的链接，建立用来进行身份认证，压缩或加密。

- PPPOE: 在这种互联网接入服务中，通信线路由以太网模拟。采用PPPoE管理以太网链接，可以利用PPP的验证等功能使各家ISP有效管理终端用户

##### 公共网络
- 模拟电话线路: 利用固定电话线路进行通信，该方法可以使用已经普及的电话网。计算机与电话线相连，需要使用一个将数字信号转化为模拟信号的调制解调器(猫)。
- 移动通信服务: 手机与PHS服务，只要在服务区范围内，就可以连接到运营商的网络。
- ADSL：对已有的模拟电话线路进行扩展的一种服务。虽然也能传输高频数字通信，但是与电信局的交换机之间只有发送音频信号时才显示极好的传说效率，并且对其他多余的频率信号进行丢弃。


#### IP
网络层的主要作用是++实现终端节点的点对点通信++。数据链路层中，一旦跨越多种数据链路，就需要借助网络层。

- 主机：配备有IP地址，但是不进行路由控制设备
- 路由器： 配有IP地址且具有路由控制能力的设备

##### 基础

 - IP寻址
 
    IP地址用于在连接到网络中的所有主机中识别进行通信的目标地址。在TCP/IP通信中所有主机或路由器必须设定自己的IP地址。与数据链路连接不会改变IP地址的形式。另外，在网桥或者交换集线器等物理层或者数据链路层转发设备中，不需要设置IP地址。只需要将IP包转化为0,1比特流。
 - 路由
 
    将分组数据发送到最终目标地址的功能。所有主机维护一个路由控制表，记录IP数据下一步发送给哪个路由器。

 - IP分包与组包
    
    不同数据链路的区别在于最大传输单位的不同(MTU), IP进行了分片处理，将较大的包分为多个较小的包。

 - 面向无连接型
    
    IP关注的是尽力服务，质量保证交付于上层TCP处理。


##### IP地址

32位, 8位1组。由网络和主机两部分标识构成区分为A,B,C,D类。

- 子网掩码：通过掩码位数划分出粒度更小的网络。
- CIDR： 无类型域间选路，任意长度分割IP地址的网络标识和主机标识。
- VLSM： 可变长子网掩码，通过域间路由协议转换为RIP2以及OSPF实现。
- NAT： 能够互换私有IP与全局IP，使得配有私有地址的主机与配有全局地址的主机实现了通信(全局IP要在整个互联网范围内保持唯一，私有地址只需要在一个域里保持唯一，不同的域出现相同私有地址不影响使用)


##### IP地址与路由控制
- 静态路由控制:管理员手动设置
- 动态路由控制:路由器与其他路由器相互交换信息时自动刷新

路由表中记录网络地址与下一步应该发送至路由器的地址。通过进行最长匹配确定。
1. 默认路由
    0.0.0.0/0或者default, 表示路由表中任何一个地址都与之匹配的记录。
    
2. 主机路由

    IP地址/32, 意思是整个IP地址的所有位都参与路由。要基于主机上网卡上配置的IP本身，而不是基于该地址的网络地址部分进行路由。
3. 环回地址

    是在同一台计算机上的程序进行通信时使用的一个默认地址。使用127.0.0.1作为环回地址，相同意义的是localhost的主机名。++使用这个ip或者主机名，数据包不会流向网络++。
    
##### IP报文的分片与重组
对于物理链路来说，MTU往往不一样。任何一台主机都有必要对IP分片进行相应的处理。经过分片之后的IP数据包在被重组的时候，只能由目标主机进行。++路由器做分片但是不会进行重组++。(IP层不保证数据包到达目的地，经过路由都有被分片的可能)

- 路径MTU发现: 指从发送端主机到接收端主机不需要分片时最大MTU的大小。即所有数据链路中最小的MTU。++从发送主机按照路径MTU的大小进行数据包分片后发送，可以避免在中途的路由器上进行分片处理。也可在TCP中发送更大的包。++

 
##### IPv6
ipv6的地址长度是128比特，写成8个16位字节。

优势: 
- IP地址的扩大与路由控制表的聚合
- 分配与其地址结构相适应的IP
- 性能提升(简化首部结构，路由器不做分片处理，路径MTU发现)
- 支持即插即用
- 认证与加密
- 多播，Mobile IP


##### ipv4首部
- 版本
- 首部长度
- 区分服务: 标明服务质量
- 总长度
- 标识：用于分片重组。同一个分片的标识值相同。不同分片不同。即使ID相同，如果目标地址，源地址，或协议不同的话，也会被认为是不同的分片。
- 标志： 标识包被分片的相关信息
- 片偏移
- 生存时间（TTL）: 最初以秒为单位记录包在网络上应该生存的期限++。实际中可以指中转多少个路由器。每经过一个路由器，TTL减少1，直到变为0丢弃该包。++
- 协议
- 首部校验和
- 源地址
- 目标地址
- 可选字段
- 填充


##### 其他协议
- DNS: 寻址
- ARP: 以目标IP地址为线索，定位下一个接受数据分包网络设备的MAC地址(ipv6中使用ICMPv6代替邻居寻址)
- RARP： 根据MAC地址定位IP地址的一种协议
- ICMP: 确认IP包是否成功送达，通知发送过程中IP包废弃的原因。
- DHCP： 自动设置IP地址，统一管理IP地址分配
- NAT：用于在本地网络使用私有地址，连接互联网使用全局IP


#### 传输层
TCP提供可靠稳定的通信传输。UDP常用于让广播和细节控制交给应用的通信传输。

在IP首部中包含一个协议字段，用来标志网络层上一层属于哪种传输协议。TCP/IP大多以客户端/服务端形式运行。服务端程序有必要提前启动来准备接受客户端的请求。此种服务端进城在UNIX系统中叫守护进程。http-httpd, ssh-sshd

传输层中类似于MAC地址与IP地址的概念为++端口号++, 端口号用来识别同一台计算机中进行通信的不同应用程序。但是，唯一标志可以通过IP地址、端口号、协议号进行通信识别。

确定端口号
- 标准既定的端口号(0-1023)
- 时序分配法: 服务端确定监听端口号，接受服务客户端没必要确定端口号

##### TCP
TCP是面向连接、可靠的流协议。提供可靠性传输，实行顺序控制或重发控制机制。此外还具备流控制、拥塞控制、提高网络利用率等众多功能。

- 充分实现了数据传输时候的各种控制功能
- 可以实现丢包时的重发控制(一定时间未收到ACK认为数据丢失)
- 对次序乱掉的分包进行顺序控制
- 确定重发超时
    
    TCP要求在所有网络环境下都提供高性能通信，所以在每次发包时都会计算往返时间以及偏差(RTT:报文往返时间)
- TCP以段为单位发送数据(++最大消息长度,MSS++), 一般在建立TCP连接同时确立。最理想情况是正好是IP中不会被分片处理的最大数据长度。MSS为三次握手时由两端主机之间计算得出。在两者之间选择一个较小值投入使用。
- 窗口控制(对每个数据进行应答，包往返时间越长，网络吞吐越差)，窗口大小就是无需等待确认应答而可以继续发送数据的最大值。
- 流控制(提供一种机制可以让发送端根据接收端的实际接受能力控制发送数据量，接收端主机通知自己可以接受数据的大小，该大小限度被称为窗口大小)
- 拥塞控制
    
    - 窗口控制使得收发主机不再以一个数据段位单位发送确认应答，也能连续发送大量数据包。如果在通信刚开始就发送大量数据，可能会引起其他问题。TCP在通信一开始就会通过慢启动的算法得到数值对发送数据量进行控制。在慢启动的时候，将拥塞窗口大小设置为1个数据段发送数据，每收到一次ACK时拥塞窗口值增加1。发送数据包时，将拥塞窗口大小与接收端主机通知的大小做比较，然后按照它们中较小的那个值，发送比其还要小的数据量。
    - 随着每次往返，拥塞窗口以指数函数增长。只要拥塞窗口值超出这个阈值，每收到应答时候，只允许以++1个数据段字节数/拥塞窗口 * 1个数据段字节数比例++放大拥塞窗口。
    - TCP通信开始时，并不设置相应的慢启动阈值。而是超时重发时，设置为拥塞窗口大小的一半。
    - 窗口大小直接影响被转发的吞吐量。窗口越大，越形成高吞吐量的通信。++TCP通信开始后，网络吞吐量逐渐上升，随着网络拥堵的发生吞吐量急速下降。之后再次慢慢上升。会逐步占领网络带宽。++

##### UDP
UDP是不具有可靠性的数据报协议。虽然确保发送消息的大小，却不能保证消息一定会到达，因此，应用有时根据自己的需要进行重发处理。

- 在网络拥堵的情况下，UDP也无法进行流量控制等行为
- 出现丢包，UDP不负责重发
- 包到达顺序乱掉时也不会进行校正
- 需要细节控制时交由UDP的应用程序进行处理。
- 面向无连接，随时发送数据


#### 路由协议
互联网是由路由器连接网络组合而成，为了能让数据包正确到达目标主机，路由器必须在途中进行正确的转发。路由器根据路由控制表转发数据包，这种进行的处理叫做++路由控制或路由++
    
- 静态路由
- 动态路由(通过给相邻路由器发送网络连接信息，这些信息像接力一样传递给其他路由器，直至整个网络都了解时，路由控制表制作完成)

一般来说，可以将静态路由与动态路由组合使用。

##### 路由控制范围
根据路由控制的范围常使用IGP(interior)和EGP(exterior)两种类型路由协议。IP地址分为网络部分与主机部分，有个字的分工。而路由选择方面，可以根据EGP在区域网络之间(或ISP)进行路由选择，可以根据IGP在区域网络内部(或ISP)内部进行主机识别。IGP中还可使用RIP(路由信息协议)、RIP2、OSPF(开放式最短路径优先)等协议。EGP使用的是BGP(边际网关协议)

制定自己的路由策略，并以此为准在一个或多个网络群体中采用的小型单位叫做自治系统(Autonomous System)或路由选择域(Routing Domain)。自治系统内部动态路由采用的协议是域内路由协议(IGP),自治系统之间的路由控制采用的是域间路由协议，即EGP。

##### 路由算法
- 距离向量算法(DV)
    
    根据距离(代价)和方向决定目标网络或目标主机的一种方法。以距离为基础制作路由控制表，每个路由器掌握的信息都不相同，通往每个网络的距离因路由器的不同而不同。这种方法在处理上比较简单，只有距离和方向的信息，不太容易判断每个路由器上的信息是否正确。所以++网络构造变得分为复杂时，获得稳定的路由信息之前需要消耗一定时间，也极易发生路由循环等问题。++
- 链路状态算法

    在路由器了解网络整体连接状态的基础上生成路由控制表的一种方法。每个路由器必须保持同样的信息才能进行正确的路由选择。任何一台路由器都有相同的网络拓扑，只要某一台路由器与其他路由器保持同样的路由控制信息，就意味着路由信息正确。只要每个路由器尽快的域其他路由器同步路由信息。就可以使路由信息达到一个稳定的状态。
    
    

路由协议 | 下一层协议 | 方式 | 适用范围 | 循环检测
---|---|---|---|---
RIP | UDP | 距离向量 | 域内 | 否
RIP2 | UDP | 距离向量 | 域内 | 否
OSFP | IP | 链路状态 | 域内 | 是
EGP(与EGP和IGP区分的特定协议) | IP | 距离向量 | 对外连接 | 否
BGP(ISP之间的路由算法，不是纯粹的链路状态与距离向量) | TCP 路径向量 | 对外连接 | 是


##### RIP
距离向量型路由协议。广泛用于LAN。
- 控制信息定期(30s)向全网广播，没有收到路由控制信息，连接断开(可能由于丢包导致，等待五次之后)
- 距离的单位为跳数。跳数指经过路由器的个数。RIP希望++尽可能少通过路由器++将数据包转发到目标IP地址。
- RIP不交换子网掩码信息
- 可以用于子网掩码的网络环境。从接口的IP地址对应分类得出网络地址后，与根据路由控制信息流过此路由器的包中的IP地址对应的分类得出的网络地址进行比较。长度相同以接口的网络地址长度为准。长度不同，以IP地址分类所确定的网络地址长度为准。
- 包的类型只有一种，同时在没有网络变化较稳定的情况下还要定期交换网络信息
- 可能出现无限计数问题，可以收到自己发出去的消息。
    - 最长距离不超过16，可以从时间上进行控制
    - 规定路由器不再把收到的路由消息原路返还给发送端，这也称作++水平分割++
    - 在有环路的情况下，并不能到位的解决问题。产生了++毒性逆转++和++触发更新++两种方法。
    - 毒性逆转： 网络中发生链路被断开的情况，不是不再发送这个消息，而是将无法通信消息传播出去。
    - 触发更新： 路由信息发生变化时，不等待30秒而是立刻发送出去。
    
在具有众多环路的复杂网络环境中，路由信息想要达到一个稳定状态需要花一段时间，为了解决问题必须明确的掌握网络结构。可以采用OSPF。

##### RIP2
在RIP的基础上进行了改进

 - 使用多播
 - 支持子网掩码
 - 路由选择域： 在同一个网络中可以使用逻辑上独立的多个RIP
 - 外部路由标志：通常用于把BGP等获得的路由控制信息通过RIP传递到AS
 - 身份验证密匙
 

##### OSPF
根据OSI的IS-IS(中间系统到中间系统)协议提出的一种++链路状态型协议++。即使网络中存在环路，也能进行稳定的路由控制。OSPF支持子网掩码，在RIP中无法实现的可变长度子网构造的网络路由控制成为现实。
- 引入区域概念，将自治网络划分为更小的范围，减少路由协议不必要的交换，一个AS内可以拥有多个区域，具有多个区域的AS必须要有一个主干区域，并且所有其他区域必须都与这个主干区域连接。
    - 区域边界路由器： 区域之外的路径信息(只发送自己到达这些路由器的距离信息)
    - 内部路由器： 本区域网络拓扑数据库
    - 主干路由器
    - AS边界路由器
- 可以针对IP首部中的区分服务字段来生成多个路由控制表
- OSPF可以给每条链路赋予一个权重，以每条链路上的代价为度量标准。始终选择一个权重最小的路径。
- 在简单网络中，相邻路由器可以直接交换路由信息。在复杂网络中，不需要在所有相邻路由器之间都进行信息交换，而是可以通过一个指定的路由器作为中心交换路由信息。
- OSPF中根据作用不同分为问候、数据库描述、链路状态请求、链路状态更新、链路状态确认应答五种类型的包。
    - 问候： 确认是否连接
    - 数据库描述： 发送路由摘要信息与版本信息。
    - 链路状态请求： 版本较老，请求路由控制信息
    - 路由状态确认： 接受路由状态信息
    - 链路状态确认： 通知大家本地已经接受路由控制信息
    
##### BGP
边界网关协议是连接不同组织机构(AS)的一种协议。属于外部网关协议(EGP)。主要用于ISP之间链接的部分。++只有BGP、RIF和OSPF共同进行路由控制，才能进行整个互联网的路由控制。++

- 在++RIP和OSPF中利用IP的网络地址部分进行路由控制++。BGP需要放眼整个互联网进行路由控制，其++最终路由控制表由网络地址和下一站的路由器组表示，会根据经过的AS个数进行路由控制。++
- ISP、区域网络等会把每个网络域编程一个个的自治系统进行管理。为每一个AS分配一个16比特的AS编号。BGP根据这个编号进行相应的路由控制
- 根据BGP减缓路由控制信息的路由器叫做BGP扬声器。为了在AS之间交换BGP信息，必须与所有AS建立对等的BGP链接。数据送达目标网络时，会生成一个中途经过所有AS的编号列表，称为AS路径信息访问列表。针对同一个目标地址出现多条路径时，++BGP从路径信息访问中选择一个较短的路由。++
- 做路由选择时候的度量，++RIP表示为路由器个数，OSPF表示为每个子网的成本，BGP采用AS进行度量标准++。BGP基于AS之间的合约进行数据包的转发，一般选择AS最少的路径，不过仍然遵循各个AS之间签约的细节进行更细粒度的路由选择。
- 路径信息访问列表中不仅包含++转发方向和距离++，还蕴含了++途经所有AS的编号++。BGP是根据所要经过的路径信息访问列表进行路由控制的协议属于路径向量型协议。他的优势在于能够检测出环路，避免无限计数问题，同时支持策略路由(可以选择或者指定所要通过的AS)。

##### MPLS
转发IP数据包的过程中除了使用路由技术之外，还在使用标记交换技术。++路由计数是基于IP地址中最长匹配原则进行转发，标记交换是对每个IP包都设置一个标记值++，根据标记值进行转发。其中代表的多协议标记交换技术MPLS。
- MPLS的标记不像是MAC地址直接对应到硬件设备。不具备以太网或者ATM等数据链路层协议作用，只需要关注它与下面一层IP之间的功能和协议。
- 基于标记的转发通常无法在路由器上进行，MPLS无法被整个互联网采用
- IP转发是根据目标IP地址通过路由器转发，标记转发是在LER(与外部网络连接的标记边缘路由器，带标记规则)根据目标IP地址附上标记(MPLS标志)然后在LSR(标记交换路由器)上根据标记表转发。
- 如果本身有一个相当于标记的信息，直接进行映射。没有携带任何标记的信息，需要追加一个全新的垫片头部，该头部包含标记信息。
- 目标地址和数据包都要通过由标记决定的同一个路径即标记交换路径(LSR)。LSP可以划分为一对一连接的点对点LSP，和一对多绑定的合并LSP两类。
- 扩展LSP的方式主要是通过各个LSR向自己邻接的LSR分配MPLS标记，也可以由路由协议载着标记信息进行交互。LSP属于单方向通路，需要双向通信需要两个LSP。

MPLS的优点主要表现在：
1. 速度转发快，路由器转发IP时，要对目标地址与路由控制表中可变长的网络地址进行比较。选出最长匹配路径。MPLS使用固定长度的标记信息。而且相比于保存大量的路由信息表，MPLS只需要设置必要的基础信息。
2. 标记生成虚拟路径，并在上面实现IP数据包通信。基于这些特点，被称为尽力而为的IP层也可以提供基于MPLS的通信质量和带宽保证、VPN等功能。


#### 应用层协议

##### 远程登录
1. TELNET
    - TSL利用tcp的一条连接向主机发送命令并在主机执行。
    - 通常与目标主机23端口建立连接，并与监听这个端口的服务端程序telnetd进行交互。也可以与其他端口连接。 telnet host 21 = ftp host
    - 仿真终端
    - 协商选项
2. SSH
    - 加密远程登录系统
    - 端口转发： 将特定端口号所收到的消息转发到特定的IP地址和端口号码(此种情况下，ssh客户端与服务端程序都起一个网关的作用)
    - 转发文件
    - 更强的认证机制
    
##### 文件传输FTP
- 需要登录对方的计算机后才能进行相应操作
- 两条tcp连接，一条用于控制，一条用于文件(数据)传输
- 控制连接
    
    使用TCP21端口在此端口上进行文件GET、PUT和LIST等操作时，每次都会建立一个用于数据传输的TCP链接。其数据传输再此上进行，之后控制用的连接继续进行命令或应答的处理。通常，++用于数据传输的TCP连接是按照与控制用的连接相反方向建立的。++
- 数据传输用的TCP连接通常使用端口20。可以使用PORT命令修改为其他的值。

##### 电子邮件
1. 基本机制

    SMTP为了实现高效的发送邮件内容，在传输层使用了TCP协议。~~早期电子邮件是直接在发送端主机与接收端主机之间建立TCP连接进行邮件传输。发送人写好邮件后，内容保存在发送端主机硬盘，与对端主机建立TCP连接。发送正常结束后，再从本地硬盘中删除邮件。发送过程中一旦发现对端计算机因某些原因没有收到邮件时，发送端将等待一定时间后重发。~~为此，在技术上改变了机制，引进一种一直会连接电源的邮件服务器。发送和接收端通过邮件服务器收发邮件。接收端从邮件服务器接受邮件使用POP3。
2. 邮件地址

    电子邮件的地址由邮件地址、数据格式、发送协议三个部分组成。现在电子邮件的发送地址由DNS进行管理，DNS中注册有邮件地址以及其作为发送地址时对应的邮件服务器的域名。这些映射信息被称为MX记录。根据MX记录中指定的邮件服务器，可以管理不同邮件地址与特定邮件服务器之间的映射关系。
3. MIME
    
    最开始互联网的电子邮件只能处理文本格式的邮件，现在所能发送的数据类型已经被扩展到MIME。MIME规定了应用消息的格式，因此在OSI参考模型中它相当于表示层。MIME由首部和正文组成。
4. SMTP
    
    使用tcp的25号端口。建立一个连接后，在这个连接上进行控制和应答以及数据的发送。客户端以文本的形式发出请求，服务端返回一个3位数字的应答。SMTP本身没有验证发送者的功能，人们通常无法避免垃圾邮件到达邮件服务器。现在通过++POP before SMTP或者SMTP认证++等功能可以进行认证
5. POP
    
    SMTP是发送邮件的协议，在个人电脑连接互联网的环境中就出现不便。个人电脑只有用户使用才会开机。为了解决问题，引入POP协议。该协议是用于接受电子邮件的协议，发送端邮件根据SMTP协议被转发给一直插电状态的POP服务器。服务端再根据POP协议从POP服务器接受对方邮件。POP也是在客户端和服务器之间建立一个TCP连接完成相应操作。
6. IMAP

    IMAP与POP类似，也是接受电子邮件的协议。++在POP中邮件由客户端进行管理，在IMAP中邮件由服务器进行管理。++使用IMAP时，可以不必从服务器上下载所有邮件。即使在不同服务器上打开邮箱，也能保持同步
    
##### www
1. 基本概念
    - 访问信息的手段与位置(URI)
    - 信息的表现形式(HTML)
    - 信息转发(HTTP)
2. URI
    
    是一种可以用于WWW之外的识别码。相比于URL狭义的概念，URI是一个广义的概念。URI可以用于除WWW之外的其他应用协议中。URI所表示的组合叫方案(scheme)，在众多URI的方案中，WWW主要用其中的http和https表示web页的位置和访问Web页的方法。
3. HTML
4. HTTP
    当用户在浏览器地址输入访问URI后，HTTP处理开始。默认使用80端口。其工作机制，首先是客户端向服务器的80端口建立一个TCP连接，然后在这个TCP连接上进行请求和应答以及数据报文的发送。在http1.0中每一个命令和应答都会触发一次TCP连接的建立和断开。从HTTP1.1开始，允许在1个TCP连接上发送多个命令和应答。大量的减少的TCP连接的建立和断开操作。

##### 网络管理
1. SNMP
    
    在TCP/IP的网络管理中可以使用SNMP收集必要信息。++SNMP是基于UDP/IP的协议++。SNMP中管理端叫做管理器(网络监控终端)，被管理端叫做代理(路由器，交换机)，决定管理器和代理之间交互信息的就是SNMP。

2. MIB 

    SNMP中交互的信息时MIB。MIB是在树形结构的数据库中为每个项目附加编号的一种信息结构。
    
##### 其他协议
1. P2P 
    
    互联网上电子邮件的通信，普通属于一台服务器对应多个客户端的C/S模式。网络上的终端或主机不经服务器直接进行1对1相互通信的情况叫做P2P。P2P中主机具备客户端和服务端两方面的功能，以对等的关系相互提供服务。
2. LDAP
    
    访问目录服务的一种协议，也叫轻量级目录访问协议。所谓目录服务是网络上存在的一种提供相关资源的数据库的服务。就像DNS是为了更简单的对网络上的各个主机进行管理，LDAP是为了更简单的管理网络上的各种资源。

#### 安全协议
##### IPsec与VPN
对机密数据的传输一般不适用互联网等公共网络，而是由专线连接的私有网络。从而在物理上杜绝了窃听和篡改数据的可能。但是由于造价太高，人们在互联网上构造一个虚拟的私有网络。即VPN，互联网中采用加密和认证技术可以达到读取数据无法读懂和检查是否被篡改的功效。
- 在构建VPN时，最常使用的是IPsec，指在IP首部的后面追加"封装安全有效载荷"和认证首部，从而对此后的数据进行加密。不被轻易解读。
- 传输模式中，加密TCP与数据部分。隧道模式中，对包括IP首部在内的整个IP包进行加密，并追加到IP首部。
    
##### TLS/SSL与HTTPS
web中可以通过TLS/SSL(Transport Layer Security/Secure Sockets Layer)对HTTP进行加密。使用TLS/SSL的HTTP通信叫做HTTPS，采用对称加密方式。而在发送公共密钥时采用的是公钥加密方式。
